---
import Card from './Card.astro';
import Heading from './Heading.astro';

interface Item {
  collection: string;
  slug?: string;
  id: string;
  data: {
    pubDate?: string;
    title: string;
    description: string;
    tags: string[];
    webURL?: string;
    slug?: string;
  };
}

const currentPath = Astro.url.pathname;
let itemPath = '';

switch (true) {
  case currentPath.includes('/projects'):
    itemPath = 'projects';
    break;
  case currentPath.includes('/writing'):
    itemPath = 'writing';
    break;
  case currentPath.includes('/speaking'):
    itemPath = 'speaking';
    break;
  case currentPath.includes('/about'):
    itemPath = 'about';
    break;
}

const collection: Item[] = Astro.props.collection || [];
console.log(
  'Collection items:',
  collection.map((item) => ({
    collection: item.collection,
    slug: item.slug,
    id: item.id,
    dataSlug: item.data.slug,
    href:
      item.collection === 'newsletters' ?
        item.data.webURL
      : `/${itemPath}/${item.data.slug || item.slug || item.id}/`,
  })),
);
---

<section
  id='all-items-list'
  class=''
>
  {
    itemPath !== 'about' && (
      <Heading
        level='h2'
        size='3xl'
        class='md:pl-4'
      >
        all {itemPath}
      </Heading>
    )
  }
  <ul class='max-w-screen-sm space-y-8'>
    {
      collection.map((item) => {
        const itemHref =
          item.collection === 'newsletters' ?
            item.data.webURL
          : `/${itemPath}/${item.slug || item.id}/`;

        return (
          <Card
            href={itemHref}
            hasLink={true}
            variant='transparent'
            class='hover:border-border hover:bg-secondary/60 transition-all md:p-4'
          >
            <Heading
              level='h3'
              size='2xl'
              class='mb-0'
            >
              {item.data.title}
            </Heading>
            <p class='line-clamp-2'>{item.data.description}</p>
            <div class='flex gap-x-4'>
              {item.data.tags?.map((tag) => (
                <span class="text-sm before:content-['#']">{tag}</span>
              ))}
            </div>
          </Card>
        );
      })
    }
  </ul>
</section>
